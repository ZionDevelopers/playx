<html>
<head>

<!--Setup layout and black background to avoid floating video on white-->
<style type="text/css">
	body {
  margin: 0;
  padding: 0;
  border: 0;
  background: #000000;
  overflow: hidden;
  }
</style>

<title>PlayX Native Youtube Host</title>
<script src="https://www.youtube.com/iframe_api"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/swfobject/2.2/swfobject.js" type="text/javascript"></script>
<script src="/playx/js/flash_detect_min.js"></script>

<script>
	
	//------------------------------------------------- GET FROM URL FUNCS -------------------------------------------------//
	
//Get a var from url format
function get(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}
	
//Separates variable from identifier, returns value of var
function getByURL(variable, query)
{
       var vars = query.split("?");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}
	
//Look At URL For Params
var urlParam = function(name, w){
    w = w || window;
    var rx = new RegExp('[\&|\?]'+name+'=([^\&\#]+)'),
        val = w.location.search.match(rx);
    return !val ? '':val[1];
}

	//------------------------------------------------- END GET FROM URL FUNCS -------------------------------------------------//


	//------------------------------------------------- START AT CODE -------------------------------------------------//

//Convert youtube #h#m#s time into seconds
//&start= or &t= can be either in pure seconds or in any order of hours, minutes, seconds in the format of #h#m#s.
//Ex: 2h41m12s = 2 hours, 41 minutes, and 12 seconds
function youtubeTimeConvert(duration){
	var total = 0;
	var hours = duration.match(/(\d+)[hH]/);
	var minutes = duration.match(/(\d+)[mM]/);
	var seconds = duration.match(/(\d+)[sS]/);
	if (hours) total += parseInt(hours[1]) * 3600;
	if (minutes) total += parseInt(minutes[1]) * 60;
	if (seconds) total += parseInt(seconds[1]);
	return total;
}
// Start Time Assignment (Universal)

//Init Working Variables
var start = urlParam('start') || "";
var t = urlParam('t') || "";

var startoutput;
	
if (start === ""){ //if start is empty, look at t
	if (t != "") {
		if (/^\d+$/.test(t)){ //if no characters found, t is in seconds
			startoutput = t;
			console.log("URL_TIME: Time t= is pure, starting at" + t);
		} else { //if characters found, decode from youtube time format
			startoutput = youtubeTimeConvert(t);
			console.log("URL_TIME: Time t= is in #h#m#s format, starting at" + t);
		}
	} else { //if start and t are empty, start at 0
		startoutput = 0;
		console.log("URL_TIME: Time Not Specified In URL, starting at 0");
	}
} else {
	if (start){
		if (/^\d+$/.test(start)) { //if start is occupied and has only numbers, start is in seconds
			startoutput = start
			console.log("URL_TIME: Time start= is pure, starting at" + start);
		} else { //else, start is in youtube time format, convert to seconds
			startoutput = youtubeTimeConvert(start);
			console.log("URL_TIME: Time start= is in #h#m#s format, starting at" + start);
		}
	}
}
	
	//------------------------------------------------- END START AT CODE -------------------------------------------------//
	
	
	//-------------------------------------------- VARIABLE DECLARATION AND PLAYERS --------------------------------------------//
	
	//Define Our Vars For Our Players
	var url = urlParam('url');
	var videoId = get('v') || getByURL('v', urlParam('url'));
	
	var playerType;

	//-------------------------------------------- END VARIABLE DECLARATION AND PLAYERS --------------------------------------------//

	//------------------------------------------------- FLASH DETECTION -------------------------------------------------//
	
//If flash is installed, use flash instead of the standard youtube embed
//This fixes the random issues with Awesomium and the YT Player
//This will be removed once CEF is live.
if (FlashDetect.installed) {
	var flashBuild = FlashDetect.raw;
	console.log("Flash Is Installed, Raw Build: " + flashBuild);
} else {
	flashBuild = "";
	console.log("Flash Is Not Installed");
}
	
if (flashBuild.match(/VLC/)){
	console.log("WARNING: VLC FLASH DETECTED WHICH DOES NOT WORK ON GARRYSMOD");
}

	//------------------------------------------------- END FLASH DETECTION -------------------------------------------------//

	//------------------------------------------------- CHOOSE PLAYER AND PLAY VIDEO -------------------------------------------------//

function onYouTubeIframeAPIReady() {
	if (FlashDetect.installed && !flashBuild.match(/VLC/)){
	    	console.log("Calling Flash Video Function");
		YouTubeFlashPlayer(videoId, startoutput);
	} else {
		console.log("Calling HTML5 Video Function");
		YouTubeIFramePlayer(videoId, startoutput);
	}
}
	
//YouTube Flash Player (yva_video)(Have to use Flash since Awesomium hates HTML5)
var YouTubeFlashPlayer = function(videoId, startoutput){
			
	//Define Player Params and Attributes (SWFObject Embed for yva_video)
	var srcparams = {
		allowScriptAccess: "always",
		bgcolor: "#000000",
		wmode: "opaque"
	};
			
	var srcattributes = {
		id: "player",
	};
	
	//Backup Format: ?enablejsapi=1&amp;autoplay=1&amp;fs=1&amp;hl=en';
	//srcurl += '&amp;modestbranding=1&amp;autohide=1&amp;showinfo=0&amp;controls=0&amp;iv_load_policy=3';

	//Native YouTube SWF: https://s.ytimg.com/yts/swfbin/player-vflJESSS0/watch_as3.swf
	//Backdoor SWF: https://youtube.googleapis.com/yva_video
	
	var srcurl = 'https://s.ytimg.com/yts/swfbin/player-vflJESSS0/watch_as3.swf?enablejsapi=1&autoplay=1';
	srcurl += '&modestbranding=1&autohide=1&showinfo=0&controls=0&iv_load_policy=3&el=embedded&origin=https%3A%2F%2Fziondevelopers.github.io&widgetid=1&ssl=1';
	srcurl += '&playerapiid=player'
	srcurl += '&docid=' + videoId + '&start=' + startoutput;
	//srcurl += '&framer=http%3A%2F%2Fziondevelopers.github.io%2Fplayx%2Fyoutubehostdev.html%3Fdocid%3D' + videoId + '&loaderUrl=http%3A%2F%2Fziondevelopers.github.io%2Fplayx%2Fyoutubehostdev.html%3Fdocid%3D' + videoId;
	//srcurl += 'controls=0&cver=1.20170718.162509712-RC7_new_canary_live&apiary_host&modestbranding=1&player_error_log_fraction=1.0&partnerid=30&authuser=0&eventid=FyBzWf-kH8S_uQKtj5fgAQ&user_display_image=https%3A%2F%2Fyt3.ggpht.com%2F-qW4i4ETXJ-E%2FAAAAAAAAAAI%2FAAAAAAAAAAA%2F9DStBklSQYs%2Fs28-c-k-no-mo-rj-c0xffffff%2Fphoto.jpg&cosver=10.0&showinfo=0&cr=US&disablekb=1&autoplay=1&start=0&origin=http%3A%2F%2Fziondevelopers.github.io&el=embedded&host_language=en&innertube_api_key=AIzaSyAO_FJ2SlqU8Q4STEHLGCilw_Y9_11qcW8&enablecastapi=1&apiary_host_firstparty&cbr=Chrome&xhr_apiary_host=youtubei.youtube.com&rel=0&ssl=1&cos=Windows&is_html5_mobile_device=false&enablejsapi=1&cbrver=59.0.3071.115&user_display_name=Adam%20Patton&c=WEB&fexp=3300114%2C3300133%2C3300164%2C3313274%2C3313321%2C9419451%2C9422596%2C9431012%2C9434289%2C9444893%2C9446364%2C9449243%2C9453897%2C9456190%2C9457141%2C9460073%2C9463594%2C9465813%2C9466793%2C9466795%2C9466797%2C9466983%2C9467217%2C9468797%2C9468799%2C9468805%2C9468866%2C9474456%2C9475116%2C9475257%2C9475676%2C9476196%2C9476914%2C9477080%2C9477432%2C9478524%2C9479168%2C9480322%2C9480475%2C9480535%2C9480703%2C9480775%2C9481684%2C9482648%2C9482672%2C9483327%2C9483356%2C9483750%2C9484209%2C9484706&gapi_hint_params=m%3B%2F_%2Fscs%2Fabc-static%2F_%2Fjs%2Fk%3Dgapi.gapi.en.KCv_LbQsffw.O%2Fm%3D__features__%2Frt%3Dj%2Fd%3D1%2Frs%3DAHpOoo-mpSzAisrxCvBIHItlQSnirCW2Ig&hl=en_US&innertube_context_client_version=1.20170718.162509712-RC7_new_canary_live&innertube_api_version=v1&fflags=yto_feature_hub_channel%3Dfalse%26disable_reporting_html5_no_vast_ads_as_error%3Dtrue%26mweb_pu_android_chrome_54_above%3Dtrue%26stop_using_ima_sdk_gpt_request_activity%3Dtrue%26html5_new_fallback%3Dtrue%26enable_prefetch_for_postrolls%3Dtrue%26html5_request_size_min_secs%3D0.0%26signed_out_notifications_inbox%3Dtrue%26ios_enable_mixin_accessibility_custom_actions%3Dtrue%26html5_reseek_on_infinite_buffer%3Dtrue%26flex_theater_mode%3Dtrue%26desktop_cleanup_companion_on_instream_begin%3Dtrue%26html5_trust_platform_bitrate_limits%3Dtrue%26html5_post_interrupt_readahead%3D20%26midroll_notify_time_seconds%3D5%26html5_variability_no_discount_thresh%3D1.0%26fixed_padding_skip_button%3Dtrue%26html5_repredict_misses_if_healthy%3D0%26website_actions_use_companion_image_as_banner%3Dtrue%26lock_fullscreen%3Dfalse%26large_play_button_hover_src%3D%26sdk_wrapper_levels_allowed%3D0%26html5_tight_max_buffer_allowed_impaired_time%3D0.0%26html5_elbow_tracking_tweaks%3Dtrue%26enable_bulleit_lidar_integration%3Dtrue%26mweb_disable_iphone_interstitial_for_ios_10_ads_backend%3Dtrue%26html5_min_buffer_to_resume%3D6%26html5_disable_urgent_upgrade_for_quality%3Dtrue%26player_destroy_old_version%3Dtrue%26kids_asset_theme%3Dserver_side_assets%26html5_min_readbehind_cap_secs%3D0%26html5_max_vss_watchtime_ratio%3D0.0%26lugash_header_by_service%3Dtrue%26yt_unlimited_pts_skip_ads_promo_desktop_always%3Dtrue%26polymer_report_missing_web_navigation_endpoint%3Dfalse%26logo_src%3D%26html5_throttle_rate%3D0.0%26html5_playing_event_buffer_underrun%3Dtrue%26dynamic_ad_break_seek_threshold_sec%3D0%26html5_reduce_startup_rebuffers%3Dtrue%26html5_timeupdate_readystate_check%3Dtrue%26html5_progressive_signature_reload%3Dtrue%26disable_max_adsense_channel_limit%3Dtrue%26html5_maximum_readahead_seconds%3D0.0%26kids_mqb_use_confirmed_safe_videos_only%3Dfalse%26html5_max_buffer_health_for_downgrade%3D15%26html5_source_buffer_required_for_play%3D0.0%26dash_manifest_version%3D5%26html5_min_readbehind_secs%3D0%26use_push_for_desktop_live_chat%3Dtrue%26watermark_src%3D%26disable_search_mpu%3Dtrue%26html5_live_disable_dg_pacing%3Dtrue%26enable_ccs_buy_flow_for_chirp%3Dtrue%26html5_vp9_live_whitelist%3Dfalse%26html5_disable_audio_slicing%3Dtrue%26html5_min_vss_watchtime_to_cut_secs_redux%3D0.0%26android_buy_bucket_buy_flows%3Dtrue%26new_promo_page%3Dtrue%26html5_get_video_info_promiseajax%3Dtrue%26lugash_header_warmup%3Dtrue%26doubleclick_gpt_retagging%3Dtrue%26show_thumbnail_behind_ypc_offer_module%3Dtrue%26yto_enable_unlimited_landing_page_yto_features%3Dtrue%26playready_on_borg%3Dtrue%26html5_strip_emsg%3Dtrue%26html5_seeks_are_not_rebuffers%3Dtrue%26html5_fallback_probe_ms%3D5000%26live_fresca_v2%3Dtrue%26disable_trusted_ad_domains_player_check%3Dtrue%26html5_stale_dash_manifest_retry_factor%3D1.0%26html5_subsegment_readahead_progress_timeout_fraction%3D0.8%26request_mpu_on_unfilled_ad_break%3Dtrue%26interaction_log_delayed_event_batch_size%3D200%26html5_background_cap_idle_secs%3D60%26website_actions_throttle_percentage%3D1.0%26html5_pipeline_manifestless%3Dtrue%26kids_enable_server_side_assets%3Dfalse%26html5_deferred_source_buffer_creation%3Dtrue%26enable_pla_desktop_shelf%3Dtrue%26enable_plus_page_pts%3Dtrue%26mweb_muted_autoplay_animation%3Dnone%26disable_indisplay_adunit_on_embedded%3Dtrue%26html5_capstone_avoidance_tolerance%3D0.4%26html5_clearance_fix%3Dtrue%26send_html5_api_stats_ads_abandon%3Dtrue%26html5_get_video_info_timeout_ms%3D0%26html5_local_max_byterate_lookahead%3D15%26report_promotes_terrorism_desktop%3Dtrue%26kids_enable_post_onboarding_red_flow%3Dtrue%26logo_gaming_src%3D%26mweb_enable_skippables_on_iphone%3Dtrue%26html5_min_secs_between_format_selections%3D8.0%26show_thumbnail_on_standard%3Dtrue%26use_fast_fade_in_0s%3Dtrue%26html5_background_quality_cap%3D360%26html5_report_conn%3Dtrue%26ad_video_end_renderer_duration_milliseconds%3D7000%26html5_retry_media_element_errors_delay%3D0%26dynamic_ad_break_pause_threshold_sec%3D0%26king_crimson_player_redux%3Dtrue%26live_readahead_seconds_multiplier%3D0.8%26mweb_blacklist_progressive_chrome_mobile%3Dtrue%26uniplayer_dbp%3Dtrue%26html5_variability_discount%3D0.5%26mweb_disable_iphone_interstitial_for_ios_10%3Dtrue%26enable_playlist_multi_season%3Dtrue%26html5_min_startup_smooth_target%3D10.0%26max_resolution_for_white_noise%3D360%26channel_about_page_gadgets%3Dtrue%26html5_subsegment_readahead_tail_margin_secs%3D0.2%26vss_dni_delayping%3D0%26html5_preload_size_excludes_metadata%3Dtrue%26show_countdown_on_bumper%3Dtrue%26ios_disable_notification_preprompt%3Dtrue%26youtubei_for_web%3Dtrue%26html5_always_reload_on_403%3Dtrue%26report_promotes_terrorism_mobile_web%3Dtrue%26html5_enable_embedded_player_visibility_signals%3Dtrue%26autoplay_time%3D8000%26android_native_live_enablement%3Dtrue%26yto_enable_watch_offer_module%3Dtrue%26mobile_disable_ad_mob_on_home%3Dtrue%26html5_subsegment_readahead_target_buffer_health_secs%3D0.5%26html5_disable_move_pssh_to_moov%3Dtrue%26html5_variability_full_discount_thresh%3D3.0%26html5_msi_error_fallback%3Dtrue%26html5_request_size_max_secs%3D0%26html5_throttle_burst_secs%3D15.0%26fix_gpt_pos_params%3Dtrue%26html5_min_vss_watchtime_to_cut_secs%3D0.0%26king_crimson_player%3Dfalse%26persist_text_on_preview_button%3Dtrue%26use_new_style%3Dtrue%26segment_volume_reporting%3Dtrue%26html5_disable_vp9_hdr_enc%3Dtrue%26android_enable_thumbnail_overlay_side_panel%3Dfalse%26html5_max_buffer_duration%3D0%26html5_minimum_readahead_seconds%3D0.0%26report_promotes_terrorism_android%3Dtrue%26html5_request_sizing_multiplier%3D0.8%26web_player_api_logging_fraction%3D0.01%26mysubs_highlight_shelf_counterfactual%3Dfalse%26html5_tight_max_buffer_allowed_bandwidth_stddevs%3D0.0%26enable_local_channel%3Dtrue%26html5_min_request_size_kb%3D64%26add_old_subscribe_button%3Dfalse%26html5_subsegment_readahead_timeout_secs%3D2.0%26html5_new_preloading%3Dtrue%26html5_chrome_ambisonics_opus%3Dtrue%26sidebar_renderers%3Dtrue%26html5_use_adaptive_live_readahead%3Dtrue%26html5_serverside_biscotti_id_wait_ms%3D1000%26ios_notifications_disabled_subs_tab_promoted_item_promo%3Dtrue%26html5_repredict_interval_secs%3D0.0%26html5_disable_non_contiguous%3Dtrue%26enable_red_carpet_p13n_shelves%3Dtrue%26chrome_promo_enabled%3Dtrue%26large_play_button_src%3D%26kids_enable_terms_servlet%3Dtrue%26html5_nnr_downgrade_count%3D4%26postroll_notify_time_seconds%3D5%26variable_load_timeout_ms%3D0%26html5_no_clear_on_quota_exceeded%3Dtrue%26html5_bandwidth_window_size%3D0%26signed_out_notification_settings%3Dtrue%26enable_live_state_auth%3Dtrue%26html5_default_quality_cap%3D0%26use_new_skip_icon%3Dtrue%26sdk_ad_prefetch_time_seconds%3D-1%26legacy_autoplay_flag%3Dtrue%26mpu_visible_threshold_count%3D2%26ad_duration_threshold_for_showing_endcap_seconds%3D15%26kids_eliminate_playlists_in_channels%3Dtrue%26enable_offer_restricts_for_watch_page_offers%3Dtrue%26kids_enable_block_servlet%3Dtrue%26report_promotes_terrorism_ios%3Dtrue%26html5_ad_no_buffer_abort_after_skippable%3Dtrue%26html5_use_mediastream_timestamp%3Dtrue%26kids_enable_privacy_notice%3Dtrue%26forced_brand_precap_duration_ms%3D2000%26html5_repredict_misses%3D5%26html5_adjust_effective_request_size%3Dtrue%26html5_min_upgrade_health%3D0%26html5_allowable_liveness_drift_chunks%3D2%26html5_suspend_manifest_on_pause%3Dtrue%26html5_max_av_sync_drift%3D50%26mweb_playsinline%3Dtrue%26mweb_autonav_paddles%3Dtrue%26html5_deadzone_multiplier%3D1.1%26html5_always_enable_timeouts%3Dtrue%26live_chunk_readahead%3D3%26html5_idle_preload_secs%3D1%26disable_client_side_midroll_freq_capping%3Dtrue%26html5_live_4k_more_buffer%3Dtrue%26html5_max_readahead_bandwidth_cap%3D0%26html5_connect_timeout_secs%3D7.0%26html5_spherical_bicubic_mode%3D0%26html5_aspect_from_adaptive_format%3Dtrue%26html5_suspended_state%3Dtrue%26pla_shelf_hovercard%3Dtrue%26html5_check_for_reseek%3Dtrue%26html5_pause_manifest_ended%3Dtrue%26html5_live_pin_to_tail%3Dtrue%26html5_head_miss_if_healthy_ms%3D0%26disable_new_pause_state3%3Dtrue%26html5_hopeless_mode_request_size_secs%3D0%26yto_enable_ytr_promo_refresh_assets%3Dtrue&loaderUrl=http%3A%2F%2Fziondevelopers.github.io%2Fplayx%2Fyoutubehostdev.html%3Fdocid%3D0BzFhT4MxRsmDRjMwMWo4NDVfdTA&playerapiid=player_uid_66101967_1&html5_unavailable=1&framer=http%3A%2F%2Fziondevelopers.github.io%2Fplayx%2Fyoutubehostdev.html%3Fv%3D0BzFhT4MxRsmDRjMwMWo4NDVfdTA';
	
	if (videoId.length > 11){
		console.log("GoogleDrive Video Detected");
		srcurl += '&partnerid=30';
	}
	
	//Set YouTube Flash Player Source URL (yva_video 
	swfobject.embedSWF(srcurl, "player", "100.0%", "100.0%", "9", null, null, srcparams, srcattributes);
			
	//Set Player Params (called by our onReady detection callback defined above)
	this.onReady = function() {
		console.log("YT Flash Player onReady() Called");
		//this.player.style.width = "126.6%";
		//this.player.style.height = "104.2%";
		//this.player.style.marginLeft = "-23.2%";
		//this.player.style.marginTop = "-2%";
		//this.player.setPlaybackQuality("hd720");
		//if (videoId.length <= 11){
		//	this.player.loadVideoById(videoId, startoutput, "hd720");
		//}
	}
	
}

//YouTube IFrame Player (Fallback until CEF)
var YouTubeIFramePlayer = function(videoId, startoutput){
	
	//YouTube Embed Code
	console.log("Playing in HTML5");
	
	player = new YT.Player('player', {
    		"width": '100%', //set size to full window or bounds of PlayX screen
		"height": '100%', //set size to full window or bounds of PlayX screen
    		videoId: videoId, //get uri from ?url=, either from ?v= or pure uri
   		playerVars: {
			wmode: "opaque",
			autoplay: 1,
			showinfo: 0, //Disable title / creator label
			cc_load_policy: 1, //Remedies issues with some captions randomly coming up
			iv_load_policy: 3, //Removes all annotations
			disablekb: 1, //Disables keybaord to avoid accidental pausing / seeking of video
			modestbranding: 1, //Remove YouTube logo
			rel: 0, //Disable end video recommendations
			controls: 0, //Disable player UI controls
			start: start || 0, //YT Start: Requires for this value to be in string format for some reason
    		},
		events: {
			onReady: onYouTubePlayerReady,
		}
  	});
	
	this.onReady = function(){
		console.log("HTML5 Player onReady() Called");
		this.player = document.getElementById('player');
		this.player.style.width = "100%";
		this.player.style.height = "100%";
		this.player.style.marginLeft = "0%";
		this.player.style.marginTop = "0%";
	}
}
	
//------------------------------------------------- GLOBAL PLAYER FUNCTIONS -------------------------------------------------//
	
	function onYouTubePlayerError(e) {
		console.log("Youtube Threw An Error :/");
		if (e>=101) {
			console.log("Switching To IFrame API");
			document.getElementById('player').parentNode.removeChild(document.getElementById('player'));
			document.body.innerHTML += '<div id="player"></div>';
			YouTubeIFramePlayer(videoId, startoutput);
		}
	}

	function onYouTubePlayerReady( playerId ) {
		var player = document.getElementById('player');
		console.log("onYouTubePlayerReady() Global Called");
		onReady();
		player.addEventListener("onError", "onYouTubePlayerError");
	}
	
//------------------------------------------------- ANALYTICS -------------------------------------------------//
	
  //Google Analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
  ga('create', 'UA-92533032-1', 'auto'); //Science Tracker
  ga('create', 'UA-43230779-1', 'ziondevelopers.github.io'); //Dathus Tracker
  ga('send', 'pageview');
  ga('ziondevelopers.github.io', 'pageview');
	
</script>
</head>

  <body>
    	<div id="player"></div>
  </body>
</html>
